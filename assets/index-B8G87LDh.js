import{u as R,_ as re,h as ye,c as q,f as k,I as pe,b as ue,e as ne,i as he,d as ve}from"./index-D83YqL5l.js";import{f as J,a6 as W,r as x,a9 as ae,q as de,j as _,s as b,t as e,y as t,v as i,x as l,a2 as n,p as ee,k as te,P as Se,F as _e,u as ze,a1 as Z,c as Q,w as ce,ab as we}from"./libs-Dw3TJ6XE.js";import{G as Le,a as Ie,b as Ce}from"./data-74Pvwkot.js";import{a4 as ge,S as O,T as X,b as He,c as oe,o as le,E as ke,Q as fe,ak as xe,R as Pe,j as Ne,al as Te,B as $e}from"./arcoDesign-BLRznqck.js";import{I as me}from"./index-BWgpDCOq.js";import{I as Ae}from"./index-KzozSCbq.js";const Me=J({__name:"accessHistoryModal",setup(Y,{expose:y}){const{t:r,d:s}=W(),S=R(),g=x(!1),f=x("");y({showModal:(o,u)=>{f.value=u,U({page:1,pageSize:10,infoHash:o}),g.value=!0}});const{data:P,total:z,current:K,loading:N,pageSize:B,changeCurrent:T,changePageSize:F,runAsync:U}=ae(Le,{pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},manual:!0,cacheKey:o=>`${S.endpoint}-torrentAccessHistory-${o==null?void 0:o[0].infoHash}-${(o==null?void 0:o[0].page)||1}-${(o==null?void 0:o[0].pageSize)||10}`}),$=[{title:()=>r("page.torrentList.accessHistory.column.downloader"),slotName:"downloader"},{title:()=>r("page.torrentList.accessHistory.column.address"),slotName:"address"},{title:"Peer ID",slotName:"peerId"},{title:()=>r("page.torrentList.accessHistory.column.traffic"),slotName:"traffic"},{title:()=>Z(O,[r("page.torrentList.accessHistory.column.offset"),Z(ge,{content:r("page.torrentList.accessHistory.column.offsetDescription")},()=>Z(q))]),slotName:"offset"},{title:"Flags",slotName:"flags"},{title:()=>r("page.torrentList.accessHistory.column.timeseen"),slotName:"time"}],A=o=>o.split(" ").map(u=>u+" - "+r("page.dashboard.peerList.column.flags."+u.trim()));return(o,u)=>{const D=de("i18n-t"),c=X,p=He,L=oe,h=pe,v=ue,m=O,M=le,I=ke,E=fe;return _(),b(E,{visible:g.value,"onUpdate:visible":u[0]||(u[0]=w=>g.value=w),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(D,{keypath:"page.torrentList.accessHistory.title"},{name:e(()=>[i(l(f.value),1)]),_:1})]),default:e(()=>[t(m,{direction:"vertical",fill:""},{default:e(()=>{var w,C;return[t(c,{style:{"font-size":"1.2em"}},{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.description")),1)]),_:1}),(w=n(P))!=null&&w.data.results||n(N)?(_(),b(M,{key:0,stripe:!0,columns:$,data:(C=n(P))==null?void 0:C.data.results,loading:n(N),pagination:{total:n(z),current:n(K),pageSize:n(B),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:n(T),onPageSizeChange:n(F)},{address:e(({record:a})=>[t(c,{code:"",copyable:"",style:{"white-space":"nowrap"}},{default:e(()=>[t(re,{ip:a.address,style:{color:"var(--color-text-2)"}},{default:e(()=>[i(l(a.address),1)]),_:2},1032,["ip"])]),_:2},1024)]),downloader:e(({record:a})=>[t(p,{color:n(ye)(a.downloader)},{default:e(()=>[i(l(a.downloader),1)]),_:2},1032,["color"])]),peerId:e(({record:a})=>[ee("p",null,[i(l(a.peerId?a.peerId:n(r)("page.banlist.banlist.listItem.empty"))+" ",1),t(L,{content:a.clientName?a.clientName:n(r)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(n(q))]),_:2},1032,["content"])])]),traffic:e(({record:a})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(h,{class:"green"}),i(" "+l(n(k)(a.uploaded)),1)]),_:2},1024),t(c,null,{default:e(()=>[t(v,{class:"red"}),i(" "+l(n(k)(a.downloaded)),1)]),_:2},1024)]),_:2},1024)]),offset:e(({record:a})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(h,{class:"green"}),i(" "+l(n(k)(a.uploadedOffset)),1)]),_:2},1024),t(c,null,{default:e(()=>[t(v,{class:"red"}),i(" "+l(n(k)(a.downloadedOffset)),1)]),_:2},1024)]),_:2},1024)]),flags:e(({record:a})=>[ee("p",null,[i(l(a.lastFlags)+" ",1),a.lastFlags?(_(),b(L,{key:0},{content:e(()=>[(_(!0),te(_e,null,Se(A(a.lastFlags),j=>(_(),te("p",{key:j},l(j),1))),128))]),default:e(()=>[t(n(q))]),_:2},1024)):ze("",!0)])]),time:e(({record:a})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.column.timeseen.first"))+": "+l(n(s)(a.firstTimeSeen,"long")),1)]),_:2},1024),t(c,null,{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.column.timeseen.last"))+": "+l(n(s)(a.lastTimeSeen,"long")),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])):(_(),b(I,{key:1,style:{height:"20vh","align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}},{default:e(()=>[i(l(n(r)("page.torrentList.accessHistory.empty")),1)]),_:1}))]}),_:1})]),_:1},8,["visible"])}}}),Ke=ne(Me,[["__scopeId","data-v-051ea996"]]),Be=J({__name:"banHistoryModal",setup(Y,{expose:y}){const r=R(),{t:s,d:S}=W(),g=x(!1),f=x("");y({showModal:(o,u)=>{f.value=u,U({page:1,pageSize:10,infoHash:o}),g.value=!0}});const{data:P,total:z,current:K,loading:N,pageSize:B,changeCurrent:T,changePageSize:F,runAsync:U}=ae(Ie,{manual:!0,pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:o=>`${r.endpoint}-torrentBanHistory-${o==null?void 0:o[0].infoHash}-${(o==null?void 0:o[0].page)||1}-${(o==null?void 0:o[0].pageSize)||10}`}),$=[{title:()=>s("page.banlog.banlogTable.column.banTime")+"/"+s("page.banlog.banlogTable.column.unbanTime"),slotName:"banAt",width:210},{title:()=>s("page.banlog.banlogTable.column.peerAddress"),slotName:"peerAddress",width:200},{title:()=>s("page.banlog.banlogTable.column.peerId"),slotName:"peerId",width:120},{title:()=>s("page.banlog.banlogTable.column.trafficSnapshot"),slotName:"peerStatus",width:150},{title:()=>s("page.banlog.banlogTable.column.description"),dataIndex:"description",ellipsis:!0,tooltip:!0}],A=Q(()=>{var o;return(o=P.value)==null?void 0:o.data.results});return(o,u)=>{const D=de("i18n-t"),c=X,p=me,L=xe,h=O,v=pe,m=ue,M=Pe,I=oe,E=q,w=le,C=fe;return _(),b(C,{visible:g.value,"onUpdate:visible":u[0]||(u[0]=a=>g.value=a),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(D,{keypath:"page.torrentList.banHistory.title"},{name:e(()=>[i(l(f.value),1)]),_:1})]),default:e(()=>[t(h,{direction:"vertical",fill:"",style:{"max-width":"1400px"}},{default:e(()=>[t(c,{style:{"font-size":"1.2em"}},{default:e(()=>[i(l(n(s)("page.torrentList.banHistory.description")),1)]),_:1}),t(w,{stripe:!0,columns:$,data:A.value,loading:n(N),pagination:{total:n(z),current:n(K),pageSize:n(B),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",onPageChange:n(T),onPageSizeChange:n(F)},{banAt:e(({record:a})=>[t(h,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(p),i(" "+l(n(S)(a.banAt,"long")),1)]),_:2},1024),t(c,null,{default:e(()=>[t(L),i(" "+l(a.unbanAt?n(S)(a.unbanAt,"long"):n(s)("page.banlog.banlogTable.notUnbanned")),1)]),_:2},1024)]),_:2},1024)]),peerAddress:e(({record:a})=>[t(c,{code:""},{default:e(()=>[t(re,{ip:a.peerIp,style:{color:"var(--color-text-2)"}},{default:e(()=>[i(l(a.peerIp)+":"+l(a.peerPort),1)]),_:2},1032,["ip"])]),_:2},1024)]),peerStatus:e(({record:a})=>[t(h,{fill:"",style:{"justify-content":"space-between"}},{default:e(()=>[t(h,{fill:"",direction:"vertical"},{default:e(()=>[t(c,null,{default:e(()=>[t(v,{class:"green"}),i(" "+l(n(k)(a.peerUploaded)),1)]),_:2},1024),t(c,null,{default:e(()=>[t(m,{class:"red"}),i(" "+l(n(k)(a.peerDownloaded)),1)]),_:2},1024)]),_:2},1024),t(I,{content:(a.peerProgress*100).toFixed(2)+"%"},{default:e(()=>[t(M,{percent:a.peerProgress,size:"mini"},null,8,["percent"])]),_:2},1032,["content"])]),_:2},1024)]),peerId:e(({record:a})=>[ee("p",null,[i(l(a.peerId?a.peerId:n(s)("page.banlist.banlist.listItem.empty"))+" ",1),t(I,{content:a.peerClientName?a.peerClientName:n(s)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(E)]),_:2},1032,["content"])])]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1})]),_:1},8,["visible"])}}}),Fe=ne(Be,[["__scopeId","data-v-4b8de521"]]),Ue=J({__name:"torrentTable",setup(Y){const y=x(!0),r=R(),{t:s}=W(),{data:S,total:g,current:f,loading:P,pageSize:z,changeCurrent:K,changePageSize:N,refresh:B,run:T}=ae(Ce,{defaultParams:[{page:1,pageSize:10}],pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:p=>`${r.endpoint}-torrentInfoList-${(p==null?void 0:p[0].page)||1}-${(p==null?void 0:p[0].pageSize)||10}`,onAfter:()=>{y.value=!1}},[ve]);ce([z,f],()=>{y.value=!0}),ce(()=>r.endpoint,B);const F=Q(()=>y.value||P.value||!$.value),U=[{title:()=>s("page.torrentList.column.name"),dataIndex:"name",ellipsis:!0,tooltip:!0,width:500},{title:"Hash",slotName:"hash",width:340},{title:()=>s("page.torrentList.column.size"),slotName:"size",width:120},{title:()=>s("page.torrentList.column.count"),slotName:"count"},{title:()=>s("page.torrentList.column.actions"),slotName:"action"}],$=Q(()=>{var p;return(p=S.value)==null?void 0:p.data.results}),A=x(),o=x(),u=we.debounce(p=>{T({page:f.value,pageSize:z.value,keyword:p})},300),D=R(),c=Q(()=>D.plusStatus);return(p,L)=>{const h=Ne,v=O,m=X,M=me,I=ge,E=Te,w=he,C=Ae,a=$e,j=oe,be=le;return _(),te(_e,null,[t(v,{direction:"vertical",fill:""},{default:e(()=>[t(v,{class:"align-right",fill:""},{default:e(()=>[t(h,{style:{width:"250px"},placeholder:n(s)("page.torrentList.accessHistory.searchPlaceholder"),"allow-clear":"","search-button":"",onSearch:n(u),onChange:n(u),onClear:L[0]||(L[0]=d=>n(T)({page:n(f),pageSize:n(z)}))},null,8,["placeholder","onSearch","onChange"])]),_:1}),t(be,{stripe:!0,columns:U,data:$.value,loading:F.value,pagination:{total:n(g),current:n(f),pageSize:n(z),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:n(K),onPageSizeChange:n(N)},{size:e(({record:d})=>[i(l(n(k)(d.size)),1)]),hash:e(({record:d})=>[t(m,{code:"",style:{"white-space":"nowrap"}},{default:e(()=>[i(l(d.infoHash),1)]),_:2},1024)]),count:e(({record:d})=>[t(v,{fill:"",direction:"vertical"},{default:e(()=>[t(I,{content:`${n(s)("page.torrentList.column.count.ban")}: ${d.peerBanCount}`},{default:e(()=>[t(m,null,{default:e(()=>[t(M),i(" "+l(d.peerBanCount),1)]),_:2},1024)]),_:2},1032,["content"]),t(I,{content:`${n(s)("page.torrentList.column.count.access")}: ${d.peerAccessCount}`},{default:e(()=>[t(m,null,{default:e(()=>[t(E),i(" "+l(d.peerAccessCount),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),action:e(({record:d})=>[t(v,{wrap:""},{default:e(()=>{var se,ie;return[t(j,{content:(se=c.value)!=null&&se.activated?n(s)("page.torrentList.column.actions.history"):n(s)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>{var G;return[t(a,{class:"edit-btn",shape:"circle",type:"text",disabled:!((G=c.value)!=null&&G.activated),onClick:H=>{var V;return(V=A.value)==null?void 0:V.showModal(d.infoHash,d.name)}},{icon:e(()=>{var H;return[(H=c.value)!=null&&H.activated?(_(),b(w,{key:0})):(_(),b(C,{key:1}))]}),_:2},1032,["disabled","onClick"])]}),_:2},1032,["content"]),t(j,{content:(ie=c.value)!=null&&ie.activated?n(s)("page.torrentList.column.actions.ban"):n(s)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>{var G;return[t(a,{class:"edit-btn",shape:"circle",type:"text",disabled:!((G=c.value)!=null&&G.activated),onClick:H=>{var V;return(V=o.value)==null?void 0:V.showModal(d.infoHash,d.name)}},{icon:e(()=>{var H;return[(H=c.value)!=null&&H.activated?(_(),b(M,{key:0})):(_(),b(C,{key:1}))]}),_:2},1032,["disabled","onClick"])]}),_:2},1032,["content"])]}),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1}),t(Ke,{ref_key:"accessHistoryModal",ref:A},null,512),t(Fe,{ref_key:"banHistoryModal",ref:o},null,512)],64)}}}),De=ne(Ue,[["__scopeId","data-v-ab0c31a3"]]),Qe=J({__name:"index",setup(Y){const{t:y}=W();return(r,s)=>{const S=X,g=O;return _(),b(g,{direction:"vertical",fill:""},{default:e(()=>[t(S,{style:{"font-size":"1.2em"}},{default:e(()=>[i(l(n(y)("page.torrentList.description")),1)]),_:1}),t(De)]),_:1})}}});export{Qe as default};
